const location_input=document.querySelector("#search"),submit=document.querySelector("#adress");function verify(e,t){e.addEventListener(t,e=>{if("Enter"===e.key||"click"===t){let e=`https://nominatim.openstreetmap.org/search?format=json&city=${location_input.value}`;fetch(e,{method:"POST"}).then(e=>e.json()).then(e=>{if(e.error)document.querySelector("#error").innerHTML=result.error;else{longitude=e[0].lon,latitude=e[0].lat;let t=new FormData;t.append("latitude",latitude),t.append("longitude",longitude),fetch("/weather/get",{method:"POST",body:t}).then(e=>e.json()).then(e=>{e.error?document.querySelector("#error").innerHTML=e.error:(temp=Math.round(e.hourly.data[setTime.value].temperature),rain=e.hourly.data[setTime.value].precipProbability,genre_male.addEventListener("click",e=>{j=0,clothes(temp,rain,j)}),genre_female.addEventListener("click",e=>{j=4,clothes(temp,rain,j)}),j=0,clothes(temp,rain,j),result=e,displayData(e),displayHourly())}).catch(e=>{console.log(e)})}}).catch(e=>{console.log(e)})}})}verify(submit,"click"),verify(location_input,"keydown");const message=document.querySelector("#message"),temperature=document.querySelector("#tempData"),pluie=document.querySelector("#tempRain"),weatherData=document.querySelectorAll(".data"),weatherDate=document.querySelector("#weather-date"),setTime=document.querySelector("#setTime"),weatherHeure=document.querySelector("#weather-heure"),weatherDay=document.querySelector("#weather-day"),weatherImg=document.querySelector("#weather-img"),compass=document.querySelector("#compass"),precedent=document.querySelector("#precedent"),suivant=document.querySelector("#suivant"),search=document.querySelector("#search"),month=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],day=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],set_clothes=document.querySelectorAll("#clothes"),array_clothes=document.querySelectorAll(".img-clothes");let time=new Date;time=time.getTime();let limit=(time=Math.round(time/1e3))+518400,base=time;var result,temp,rain,latitude=48.866667,longitude=2.333333;async function getSession(){const e=await fetch("/weather/session",{method:"POST"}),t=await e.json();if(t){let e=t.adresse,a=t.ville,r="https://nominatim.openstreetmap.org/search?format=json&q=";!async function(){const t=await fetch(r+e+","+a,{method:"GET"}),i=await t.json();console.log(i[0].lat),console.log(i[0].lon),latitude=i[0].lat,longitude=i[0].lon,getInitialData()}(),console.log(t)}else getInitialData(),document.onreadystatechange=function(){"complete"===document.readyState&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){time=(time=new Date).getTime(),time=Math.round(time/1e3),limit=time+518400,base=time,precedent.style.display="none",latitude=e.coords.latitude,longitude=e.coords.longitude;let t=new FormData;t.append("latitude",latitude),t.append("longitude",longitude),fetch("/weather/get",{method:"POST",body:t}).then(e=>e.json()).then(e=>{result=e,displayData(e),temp=Math.round(e.hourly.data[setTime.value].temperature),rain=e.hourly.data[setTime.value].precipProbability,j=0,clothes(temp,rain,j);let t=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${e.latitude}&lon=${e.longitude}`;fetch(t,{method:"POST"}).then(e=>e.json()).then(e=>{if(!e.error){let t;t=void 0!==e.address.city?e.address.city:void 0===e.address.city&&void 0!==e.address.town?e.address.town:e.address.village,document.querySelector("#search").value=t}}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)})})}}function clothes(e,t,a){if(e>=4&&t<.15){for(let e=0;e<array_clothes.length;e++)array_clothes[e].classList.add("invisible");set_clothes[a+0].classList.remove("invisible")}else if(e>=4&&t>.15){for(let e=0;e<array_clothes.length;e++)array_clothes[e].classList.add("invisible");set_clothes[a+1].classList.remove("invisible")}else if(e<4&&t<.15){for(let e=0;e<array_clothes.length;e++)array_clothes[e].classList.add("invisible");set_clothes[a+2].classList.remove("invisible")}else if(e<4&&t>.15){for(let e=0;e<array_clothes.length;e++)array_clothes[e].classList.add("invisible");set_clothes[a+3].classList.remove("invisible")}}function displayData(e){let t=Math.round(e.hourly.data[0].temperature),a=Math.round(e.hourly.data[3].temperature),r=Math.round(e.hourly.data[6].temperature),i=Math.round(e.hourly.data[9].temperature),n=Math.round(e.hourly.data[12].temperature),o=Math.round(e.hourly.data[15].temperature),l=Math.round(e.hourly.data[18].temperature),s=Math.round(e.hourly.data[21].temperature),d=Math.round(e.hourly.data[23].temperature),u=[t,a,r,i,n,o,l,s,d],c=Math.max.apply(null,u),m=Math.min.apply(null,u),y=c>20?c+2:20,h=m<0?m-2:0,g=Math.round(100*e.hourly.data[0].precipProbability),p=Math.round(100*e.hourly.data[3].precipProbability),v=Math.round(100*e.hourly.data[6].precipProbability),b=Math.round(100*e.hourly.data[9].precipProbability),f=Math.round(100*e.hourly.data[12].precipProbability),L=Math.round(100*e.hourly.data[15].precipProbability),M=Math.round(100*e.hourly.data[18].precipProbability),T=Math.round(100*e.hourly.data[21].precipProbability),w=Math.round(100*e.hourly.data[23].precipProbability);new Chart(document.getElementById("summaryChart"),{type:"line",data:{labels:["00:00","03:00","06:00","09:00","12:00","15:00","18:00","21:00","24:00"],datasets:[{radius:0,data:[t,a,r,i,n,o,l,s,d],yAxisID:"temperature",label:"Température",borderColor:"#980000",backgroundColor:"rgba(152, 0, 0, 0.4)",fill:!0},{radius:0,data:[g,p,v,b,f,L,M,T,w],yAxisID:"rain",label:"Précipitation",borderColor:"#030340",backgroundColor:"rgba(3, 3, 54, 0.4)",fill:!0}]},options:{legend:{display:!1},title:{display:!1,text:"Températures et précipitations"},scales:{yAxes:[{type:"linear",display:!0,ticks:{fontColor:"#980000",min:h,max:y,callback:function(e,t,a){return e+"°C"}},position:"left",id:"temperature"},{type:"linear",display:!0,position:"right",id:"rain",ticks:{fontColor:"#030340",min:0,max:100,callback:function(e,t,a){return e+"%"}},gridLines:{drawOnChartArea:!1}}]}}});let _="";switch(Math.round(8*e.daily.data[0].moonPhase)/8){case 0:case 1:_="Nouvelle lune";break;case.125:case.875:_="Croissant";break;case.25:case.375:case.625:case.75:_="Demi lune";break;case.5:_="Pleine lune"}let S,k,D,q,H=new Date(1e3*e.currently.time),j=new Date(1e3*e.daily.data[0].sunsetTime),P=new Date(1e3*e.daily.data[0].sunriseTime);S=P.getHours()<10?"0"+P.getHours():P.getHours(),k=P.getMinutes()<10?"0"+P.getMinutes():P.getMinutes(),D=j.getHours()<10?"0"+j.getHours():j.getHours(),q=j.getMinutes()<10?"0"+j.getMinutes():j.getMinutes(),weatherDay.innerHTML=day[H.getDay()],weatherDate.innerHTML=H.getDate()+" "+month[H.getMonth()]+" "+H.getFullYear(),message.innerHTML=e.currently.summary,temperature.innerHTML=Math.round(e.currently.temperature)+"°C",weatherImg.src="../Assets/img/weather-icons/"+e.currently.icon+".svg",pluie.innerHTML=Math.round(100*e.currently.precipProbability)+"%",weatherData[0].innerHTML=S+":"+k,weatherData[1].innerHTML=D+":"+q,weatherData[2].innerHTML=_,weatherData[3].innerHTML=Math.round(e.currently.pressure)+" hPa",weatherData[4].innerHTML=Math.round(e.currently.windSpeed)+" m/s",weatherData[5].innerHTML=Math.round(e.currently.humidity)+"%",weatherData[6].innerHTML=Math.round(100*e.currently.precipProbability)+"%",weatherData[7].innerHTML=Math.round(e.currently.temperature)+"°C",weatherData[8].innerHTML=Math.round(e.currently.uvIndex),weatherData[9].innerHTML=Math.round(e.currently.visibility)+" km",setTime.value=H.getHours(),weatherHeure.innerHTML=H.getHours()+":00",compass.style.transform="rotate("+e.currently.windBearing+"deg"}function displayHourly(){message.innerHTML=result.hourly.data[setTime.value].summary,temperature.innerHTML=Math.round(result.hourly.data[setTime.value].temperature)+"°C",weatherImg.src="../Assets/img/weather-icons/"+result.hourly.data[setTime.value].icon+".svg",pluie.innerHTML=Math.round(100*result.hourly.data[setTime.value].precipProbability)+"%",weatherData[3].innerHTML=Math.round(result.hourly.data[setTime.value].pressure)+" hPa",weatherData[4].innerHTML=Math.round(result.hourly.data[setTime.value].windSpeed)+" m/s",weatherData[5].innerHTML=Math.round(result.hourly.data[setTime.value].humidity)+"%",weatherData[6].innerHTML=Math.round(100*result.hourly.data[setTime.value].precipProbability)+"%",weatherData[7].innerHTML=Math.round(result.hourly.data[setTime.value].temperature)+"°C",weatherData[8].innerHTML=Math.round(result.hourly.data[setTime.value].uvIndex),weatherData[9].innerHTML=Math.round(result.hourly.data[setTime.value].visibility)+" km",weatherHeure.innerHTML=setTime.value+":00",compass.style.transform="rotate("+result.hourly.data[setTime.value].windBearing+"deg";let e=Math.round(result.hourly.data[setTime.value].temperature),t=result.hourly.data[setTime.value].precipProbability;genre_male.addEventListener("click",a=>{j=0,clothes(e,t,j)}),genre_female.addEventListener("click",a=>{j=4,clothes(e,t,j)}),clothes(e,t,j)}function getPreviousDay(){let e=new FormData;time-=86400,precedent.style.display=time===base?"none":"block",suivant.style.display=time===limit?"none":"block",precedent.style.display=time===base?"none":"block",e.append("latitude",latitude),e.append("longitude",longitude),e.append("time",time),fetch("/weather/get",{method:"POST",body:e}).then(e=>e.json()).then(e=>{result=e,displayData(e),displayHourly(e);let t=Math.round(e.hourly.data[setTime.value].temperature),a=e.hourly.data[setTime.value].precipProbability;genre_male.addEventListener("click",e=>{j=0,clothes(t,a,j)}),genre_female.addEventListener("click",e=>{j=4,clothes(t,a,j)}),clothes(t,a,j)}).catch(e=>{console.log(e)})}function getNextDay(){let e=new FormData;time+=86400,suivant.style.display=time===limit?"none":"block",precedent.style.display=time===base?"none":"block",suivant.style.display=time===limit?"none":"block",e.append("latitude",latitude),e.append("longitude",longitude),e.append("time",time),fetch("/weather/get",{method:"POST",body:e}).then(e=>e.json()).then(e=>{result=e,displayData(e),displayHourly(e);let t=Math.round(e.hourly.data[setTime.value].temperature),a=e.hourly.data[setTime.value].precipProbability;genre_male.addEventListener("click",e=>{j=0,clothes(t,a,j)}),genre_female.addEventListener("click",e=>{j=4,clothes(t,a,j)}),clothes(t,a,j)}).catch(e=>{console.log(e)})}function getInitialData(){let e=new FormData;e.append("latitude",latitude),e.append("longitude",longitude),fetch("/weather/get",{method:"POST",body:e}).then(e=>e.json()).then(e=>{result=e,displayData(e),temp=Math.round(e.hourly.data[setTime.value].temperature),rain=e.hourly.data[setTime.value].precipProbability,genre_male.addEventListener("click",e=>{j=0,clothes(temp,rain,j)}),genre_female.addEventListener("click",e=>{j=4,clothes(temp,rain,j)}),j=0,clothes(temp,rain,j),suivant.addEventListener("click",()=>{getNextDay()}),precedent.addEventListener("click",()=>{getPreviousDay()}),setTime.addEventListener("change",()=>{displayHourly()});let t=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${e.latitude}&lon=${e.longitude}`;fetch(t,{method:"POST"}).then(e=>e.json()).then(e=>{if(!e.error){let t;t=void 0!==e.address.city?e.address.city:void 0===e.address.city&&void 0!==e.address.town?e.address.town:e.address.village,document.querySelector("#search").value=t}})}).catch(e=>{console.log(e)})}getSession();const connexionLogin=document.querySelector("#connexion_login"),loginLogin=document.querySelector("#login_login"),passLogin=document.querySelector("#pass_login"),messageLogin=document.querySelector("#error");function verify(e,t){null!=e&&e.addEventListener(t,e=>{if(console.log("listener"),"Enter"===e.key||"click"===t){console.log("un evenement");let e=new FormData;e.append("login",loginLogin.value),e.append("pass",passLogin.value),fetch("/login/verif",{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.error?document.querySelector("#error").innerHTML=e.error:(console.log(e),console.log(e.adresse),console.log(e.ville),document.querySelector("#error").innerHTML="Connexion réussie")})}})}verify(connexionLogin,"click"),verify(loginLogin,"keydown"),verify(passLogin,"keydown");const genre_male=document.querySelector("#maleButton"),genre_female=document.querySelector("#femaleButton"),avatar_m1=document.querySelector("#avatar_m1"),avatar_m2=document.querySelector("#avatar_m2"),avatar_m3=document.querySelector("#avatar_m3"),avatar_m4=document.querySelector("#avatar_m4"),avatar_f1=document.querySelector("#avatar_f1"),avatar_f2=document.querySelector("#avatar_f2"),avatar_f3=document.querySelector("#avatar_f3"),avatar_f4=document.querySelector("#avatar_f4"),array_avatar=document.querySelectorAll(".img-avatar"),array_skin=document.querySelectorAll(".skinButton"),skin1=document.querySelector("#skin1"),skin2=document.querySelector("#skin2"),skin3=document.querySelector("#skin3"),skin4=document.querySelector("#skin4");avatar_m1.classList.remove("invisible"),genre_male.classList.add("genre"),genre_female.classList.remove("genre");for(let e=1;e<array_avatar.length;e++)array_avatar[e].classList.add("invisible");for(let e=0;e<array_skin.length;e++)array_skin[e].addEventListener("click",t=>{for(let e=0;e<array_avatar.length;e++)array_avatar[e].classList.add("invisible");array_avatar[e].classList.remove("invisible")});genre_male.addEventListener("click",e=>{avatar_m1.classList.remove("invisible"),genre_male.classList.add("genre"),genre_female.classList.remove("genre");for(let e=1;e<array_avatar.length;e++)array_avatar[e].classList.add("invisible");for(let e=0;e<array_skin.length;e++)array_skin[e].addEventListener("click",t=>{for(let e=0;e<array_avatar.length;e++)array_avatar[e].classList.add("invisible");array_avatar[e].classList.remove("invisible")})}),genre_female.addEventListener("click",e=>{for(let e=0;e<array_avatar.length;e++)array_avatar[e].classList.add("invisible");avatar_f1.classList.remove("invisible"),genre_female.classList.add("genre"),genre_male.classList.remove("genre");for(let e=0;e<array_skin.length;e++)array_skin[e].addEventListener("click",t=>{for(let e=0;e<array_avatar.length;e++)array_avatar[e].classList.add("invisible");array_avatar[e+4].classList.remove("invisible")})}),new Chart(document.getElementById("summaryChart"),{type:"line",data:{labels:["00:00","06:00","12:00","18:00","23:00"],datasets:[{data:[1,3,8,5,2],yAxisID:"temperature",label:"Température",borderColor:"#980000",fill:!0},{data:[0,2,5,10,3],yAxisID:"rain",label:"Précipitation",borderColor:"#030340",fill:!0}]},options:{legend:{display:!1},title:{display:!1,text:"World population per region (in millions)"},scales:{yAxes:[{type:"linear",display:!0,position:"left",id:"temperature"},{type:"linear",display:!0,position:"right",id:"rain",ticks:{min:0,max:100},gridLines:{drawOnChartArea:!1}}]}}});const sidebarButton=document.querySelector("#sidebarCollapse"),dismiss=document.querySelector("#dismiss"),sidebar=document.querySelector("#sidebar"),overlay=document.querySelector("#overlay");document.addEventListener("DOMContentLoaded",function(){sidebarButton.addEventListener("click",e=>{sidebar.classList.toggle("active"),overlay.classList.toggle("active")}),dismiss.addEventListener("click",e=>{sidebar.classList.toggle("active"),overlay.classList.toggle("active")})});const validerRegister=document.querySelector("#valider-register"),mailRegister=document.querySelector("#mail-register"),passRegister=document.querySelector("#pass-register"),prenomRegister=document.querySelector("#prenom-register"),adresseRegister=document.querySelector("#adresse-register"),villeRegister=document.querySelector("#ville-register");function verifyRegister(e,t){e.addEventListener(t,e=>{if("Enter"===e.key||"click"===t){let e=new FormData;e.append("mail",mailRegister.value),e.append("pass",passRegister.value),e.append("prenom",prenomRegister.value),e.append("adresse",adresseRegister.value),e.append("ville",villeRegister.value),fetch("/register/verif",{method:"POST",body:e}).then(e=>e.json()).then(e=>{if(console.log(e),e.message){document.querySelector(".message").innerHTML="";for(let t=0;t<e.message.length;t++)document.querySelector(".message").innerHTML+=e.message[t]+"</br>"}else document.querySelector(".message").innerHTML="Inscription réussie, vous allez être redirigé.",setTimeout(function(){window.location.replace("/weather")},3e3)})}})}document.onreadystatechange=function(){"complete"===document.readyState&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){let t=e.coords.latitude,a=e.coords.longitude;fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat="+t+"&lon="+a,{method:"POST"}).then(e=>e.json()).then(e=>{let t;t=void 0!==e.address.city?e.address.city:void 0===e.address.city&&void 0!==e.address.town?e.address.town:e.address.village;let a=e.address.road;adresseRegister.value=a,villeRegister.value=t})})},verifyRegister(validerRegister,"click"),verifyRegister(mailRegister,"keydown"),verifyRegister(passRegister,"keydown"),verifyRegister(prenomRegister,"keydown"),verifyRegister(adresseRegister,"keydown"),verifyRegister(villeRegister,"keydown");
//# sourceMappingURL=app.js.map